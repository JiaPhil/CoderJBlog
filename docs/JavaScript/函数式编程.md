# å‡½æ•°å¼ç¼–ç¨‹

## å‰è¨€

å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹æ€§
* [çº¯å‡½æ•°](#çº¯å‡½æ•°pure-funtions)
* [å‡½æ•°æŸ¯é‡ŒåŒ–](#å‡½æ•°æŸ¯é‡ŒåŒ–haskell-brooks-curry)
* [å‡½æ•°ç»„åˆ](#å‡½æ•°ç»„åˆ)

```tex
å‡½æ•°å¼ç¼–ç¨‹ç¼–ç¨‹åº“lodash

å‡½æ•°å¼ç¼–ç¨‹äº‹å¯¹è¿ç®—è¿‡ç¨‹è¿›è¡ŒæŠ½è±¡
é¢å‘å¯¹è±¡ç¼–ç¨‹æ˜¯å¯¹ç°å®ä¸–ç•Œä¸Šçš„äº‹ç‰©è¿›è¡ŒæŠ½è±¡

å‡½æ•°å¼ç¼–ç¨‹ å€¼çš„æ˜¯æ•°å­¦ä¸­çš„å‡½æ•°å³æ˜ å°„å…³ç³»

ç›¸åŒè¾“å…¥å§‹ç»ˆè¦å¾—åˆ°ç›¸åŒçš„è¾“å‡ºï¼ˆçº¯å‡½æ•°ï¼‰
å‡½æ•°å¼ç¼–ç¨‹ ç”¨æ¥æè¿°æ•°æ®(å‡½æ•°)ä¹‹é—´çš„æ˜ å°„
```

### å‡½æ•°å¼
- ç”¨å‡½æ•°å†™ç¨‹åº
- å®ç°æœ€å°ç²’åº¦çš„å‡½æ•°å°è£…ã€ç»„åˆã€å¤ç”¨ï¼ˆæŸ¯é‡ŒåŒ–ï¼‰
- æ›´æ¢æ€ç»´æ–¹å¼ï¼šç”¨è¡¨è¾¾å¼æ¥æè¿°ç¨‹åº
- é€’å½’æ˜¯å¸¸ç”¨æ‰‹æ®µ
- å‡½æ•°æ²¡æœ‰å‰¯ä½œç”¨ï¼ˆè¾“å…¥å¯¹è¾“å‡ºæ˜ å°„ æ²¡å¯¹å…¶ä»–è¿›è¡Œæ“ä½œï¼‰


### é«˜é˜¶å‡½æ•°

- å¯ä»¥æŠŠå‡½æ•°ä½œä¸º**å‚æ•°**ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°
- å¯ä»¥æŠŠå‡½æ•°å¦ä¸€ä¸ªå‡½æ•°çš„**è¿”å›å€¼**

```ts
// å‡½æ•°ä½œä¸ºè¿”å›å€¼
function makeFn(){
  return function (){
    console.log('hello Fn')
  }
}

function once(fn) {
  let done = false
  return function () {
    if(!done){
      done = true 
      // this æŒ‡å‘çš„æ˜¯function() åŒ¿åå‡½æ•°
      return fn.apply(this, arguments)
    }
  }
}

const pay = once(function (money){
  console.log('ddd')
})

pay(5)
```

- é«˜é˜¶å‡½æ•°ï¼šå±è”½ç»†èŠ‚ï¼Œåªéœ€å…³æ³¨ç›®æ ‡ï¼ŒæŠ½è±¡é€šç”¨çš„å‡½æ•°

### å¸¸ç”¨é«˜é˜¶å‡½æ•°
- map
- every
- some

```ts
// å®ç°mapå‡½æ•°
const map = (array: Array<string>, fn: Function) => {
  let results = []
  for(let value of array){
    results.push(fn(value))
  }
  return results
}

// å®ç°everyå‡½æ•°: åˆ¤æ–­æ•°ç»„ä¸­æ¯ä¸€ä¸ªå…ƒç´ æ˜¯å¦éƒ½æ»¡è¶³æ¡ä»¶
const every = (array: Array<any>, fn: Function) => {
  let results = false;
  for (let value of array) {
    results = fn(value);
    if (!results) {
      break;
    }
  }
  return results;
};

// å®ç°someå‡½æ•°: åˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªå…ƒç´ æ»¡è¶³æ¡ä»¶
const some = (array: Array<any>, fn: Function) => {
  let results = false;
  for (let value of array) {
    results = fn(value);
    if (results) {
      break;
    }
  }
  return results;
};
``` 


## é—­åŒ…(Closure)

1. é—­åŒ…: å‡½æ•°å’Œå…¶å‘¨å›´çš„çŠ¶æ€çš„å¼•ç”¨æ†ç»‘åœ¨ä¸€èµ·å½¢æˆé—­åŒ…
2. **æ¦‚å¿µ**ï¼šå¯ä»¥åœ¨å¦ä¸€ä¸ªä½œç”¨åŸŸ è°ƒç”¨ä¸€ä¸ªå‡½æ•°çš„å†…éƒ¨å‡½æ•°å¹¶è®¿é—®åˆ°å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸçš„æˆå‘˜
3. (å‡½æ•°ä½œä¸ºå¦ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼)
4. **ä½œç”¨**ï¼šå»¶é•¿å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸæˆå‘˜çš„ä½œç”¨èŒƒå›´

```ts
function makeFn() {
  let meg = 'Hello World'
  return function () {
    console.log(msg)
  }
}
// makeFnä»æ‰§è¡Œæ ˆä¸Šç§»é™¤ï¼Œä½†msgè¢«å¤–éƒ¨å‡½æ•°å¼•ç”¨ä¸èƒ½é‡Šæ”¾
let f = makeFn()
```

- é—­åŒ…çš„æœ¬è´¨ï¼šå‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ä¼šæ”¾åˆ°ä¸€ä¸ªæ‰§è¡Œæ ˆä¸Š å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åä¼šä»æ‰§è¡Œæ ˆä¸Šç§»é™¤ï¼Œä½†æ˜¯å †ä¸Šçš„ä½œç”¨åŸŸæˆå‘˜è¢«å¤–éƒ¨å¼•ç”¨ä¸èƒ½é‡Šæ”¾ï¼Œå› æ­¤å†…éƒ¨å‡½æ•°ä¾æ—§å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°æˆå‘˜


## çº¯å‡½æ•°(Pure funtions)
### çº¯å‡½æ•°æ¦‚å¿µ
- å¿…é¡»è¦å‚æ•°å’Œè¿”å›å€¼
- ç›¸åŒçš„è¾“å…¥æ°¸è¿œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡º,ä¸ä¼šæœ‰ä»»ä½•å‰¯ä½œç”¨(ä¸ä¼šæ”¹å˜åŸæ•°æ®)
- ç»†åˆ†ä¸ºå¯å¤ç”¨çš„å°å‡½æ•°ï¼Œåªä¸“æ³¨è¾“å…¥è¾“å‡ºå¹¶ç›¸åŒçš„è¾“å…¥æ°¸è¿œä¼šå¾—åˆ°ç›¸åŒçš„è¾“å‡º
- ğŸš©loadash:  https://www.lodashjs.com/

```ts
function gerSum(n1, n2){
  return n1 + n2
}
```
- å‡½æ•°å¼ç¼–ç¨‹ä¸ä¼šä¿ç•™ä¸­é—´çš„è®¡ç®—ç»“æœï¼Œæ‰€ä»¥å˜é‡å¼ä¸å¯å˜çš„ï¼ˆæ— çŠ¶æ€çš„ï¼‰

### çº¯å‡½æ•°çš„å¥½å¤„

* å¯ç¼“å­˜ï¼Œæé«˜æ€§èƒ½ _.memoize()
* å¯æµ‹è¯•
* å¹¶è¡Œå¤„ç†



```ts
// æ¨¡æ‹Ÿmemoize
function memoize(fn:Function){
 let cache = {}
 return function () {
    const key = JSON.stringify(arguments)
    cache[key] = cache[key] || fn.apply(f, arguments)
    return cache[key]
 }
}
```

### å‰¯ä½œç”¨
```ts
// ä¸çº¯çš„ ï¼ˆå—å¤–éƒ¨æ¡ä»¶å½±å“ï¼‰
let mini = 18 
function checkAge (age: number): boolean {
   return age >= mini 
}
// çº¯çš„(æœ‰ç¡¬ç¼–ç ï¼Œåç»­å¯ä»¥é€šè¿‡æŸ¯é‡ŒåŒ–è§£å†³) 
function checkAge (age: number): boolean {
   let mini = 18 
   return age >= mini 
}
```
å‰¯ä½œç”¨æ˜¯è®©ä¸€ä¸ªå‡½æ•°å˜å¾—ä¸çº¯ä¼šé™ä½ä¸€ä¸ªå‡½æ•°çš„å¤ç”¨æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå¦‚æœå‡½æ•°ä¾èµ–äºå¤–éƒ¨çŠ¶æ€å°±æ— æ³•ä¿è¯è¾“å‡ºç›¸åŒï¼Œå°±ä¼šå¸¦æ¥å‰¯ä½œç”¨ã€‚

å‰¯ä½œç”¨æ¥æº
* å…¨å±€å˜é‡
* é…ç½®æ–‡ä»¶
* æ•°æ®åº“
* è·å–ç”¨æˆ·è¾“å…¥
* ......


## å‡½æ•°æŸ¯é‡ŒåŒ–(Haskell Brooks Curry)

* å½“ä¸€ä¸ªå‡½æ•°æœ‰å¤šä¸ªå‚æ•°çš„æ—¶å€™å…ˆä¼ é€’ä¸€éƒ¨åˆ†å‚æ•°è°ƒç”¨å®ƒï¼ˆè¿™éƒ¨åˆ†å‚æ•°ä»¥åæ°¸è¿œä¸å˜ï¼‰ 
* ç„¶åè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°æ¥æ”¶å‰©ä½™çš„å‚æ•°ï¼Œè¿”å›ç»“æœ

```ts
// å»é™¤ä¸Šä¾‹ç¡¬ç¼–ç 
funtion checkAge(min: number) {
  return function (age: number) {
    return age >= min
  }
}

// ES6
let checkAge = min => (age => age >= min)
```

### loadashçš„æŸ¯é‡ŒåŒ–
* _.curry(func)
  * åŠŸèƒ½: åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶ä¸€ä¸ªæˆ–å¤šä¸ªfuncçš„å‚æ•°ï¼Œå¦‚æœfuncæ‰€éœ€è¦çš„å‚æ•°éƒ½è¢«æä¾›åˆ™ç›´æ¥æ‰§è¡Œfuncå¹¶è¿”å›ç»“æœã€‚å¦åˆ™ç»§ç»­è¿”å›è¯¥å‡½æ•°å¹¶ç­‰å¾…æ¥æ”¶å‰©ä½™å‚æ•°
  * å‚æ•°: éœ€è¦æŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼Œçº¯å‡½æ•°
  * è¿”å›å€¼: æŸ¯é‡ŒåŒ–åçš„å‡½æ•°

### æŸ¯é‡ŒåŒ–æ¡ˆä¾‹

```ts
// åŒ¹é…ç©ºç™½å­—ç¬¦
const _ = required('loadash')

const match = _.curry(function (reg, str) {
  return str.match(reg)
})

const haveSpace = match(/\s+/g)
console.log(haveSpace('hello world'))

// filter
const filter = _.curry(function (func, array) {
  return array.filter(func)
})

const findSpace = filter(haveSpace)
console.log(findSpace(['John Son', 'John_Donne']))
```
* _.curryå‚æ•°æ˜¯ä¸€ä¸ªfuncå¹¶è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè‹¥æä¾›å…¨éƒ¨å‚æ•° åˆ™è¿”å›è¯¥funcçš„è¿”å›å€¼ï¼Œè‹¥æ²¡æœ‰æä¾›å…¨éƒ¨å‚æ•°ï¼Œcurryç»§ç»­è¿”å›è¯¥funcå¹¶ç­‰å¾…æ¥å—å‰©ä½™å‚æ•°

### å®ç°åŸç†
* funcä½œä¸ºå‚æ•°
* è°ƒç”¨å½¢å¼
  * å½¢å‚ == å®å‚ ç›´æ¥è°ƒç”¨func
  * å½¢å‚ > å®å‚ è¿”å›ä¸€ä¸ªå‡½æ•° å¹¶ç­‰å¾…æ¥å—å‰©ä½™å‚æ•°

```ts
function curry (func: Function) {
  return function curriedFn(...args) {
    // å®å‚é•¿åº¦å¤§äºå½¢å‚é•¿åº¦
    if(args.length < func.length){
      // è¿”å›ä¸€ä¸ªå‡½æ•°å¹¶ç­‰å¾…æ¥æ”¶å‚æ•°
      return function () {
        return curriedFn(...args.concat(Array.from(arguments)))
      }
    }
    return func(...args)
  }
}
```

### æ€»ç»“
* æŸ¯é‡ŒåŒ–å¯ä»¥è®©æˆ‘ä»¬ç»™ä¸€ä¸ªå‡½æ•°ä¼ é€’è¾ƒå°‘çš„å‚æ•°å¾—åˆ°ä¸€ä¸ªå·²ç»è®°ä½äº†æŸäº›å›ºå®šå‚æ•°çš„æ–°å‡½æ•°ï¼ˆé—­åŒ…ï¼‰
* è¿™æ˜¯ä¸€ç§å¯¹å‡½æ•°å‚æ•°çš„'ç¼“å­˜'ï¼ˆé—­åŒ…ï¼‰
* è®©å‡½æ•°å˜çš„æ›´çµæ´»ï¼Œè®©å‡½æ•°çš„ç²’åº¦æ›´å°
* å¯ä»¥æŠŠå¤šå…ƒå‡½æ•°è½¬æ¢æˆä¸€å…ƒå‡½æ•°ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨å‡½æ•°äº§ç”Ÿå¼ºå¤§çš„åŠŸèƒ½


## å‡½æ•°ç»„åˆ

